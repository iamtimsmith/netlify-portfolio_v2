{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/using-mongodb-with-express-js/","webpackCompilationHash":"d6a7e20621bffa5f0a6a","result":{"data":{"markdownRemark":{"html":"<p>MongoDB is a nosql database that is growing in popularity. In this post, I'll show you how you can use it in your next Express application. The MERN stack (MongoDB, Express, React, Node), MEAN stack (MongoDB, Express, Angular, Node), and MEVN stack (MongoDB, Express, Vue, Node) all use MongoDB as a database since it's so easy to read information. Let's get right into it!</p>\n<h2>What is MongoDB?</h2>\n<p>SQL is a type of database that has been around for a long time and allows tables to be relational. NoSQL databases, such as MongoDB, are a type of non-relational databases which can use various data structures. MongoDB uses a document structure which ends up looking like a JSON object with key/value pairs.</p>\n<p>Like SQL, it can be used locally or from a remote platform. When using it locally, it will store the data in a specified location, but won't work until you run <code>mongod</code> in the terminal. In recent years, platforms such as <a href=\"https://mlab.com/\">mLab</a> and <a href=\"https://www.mongodb.com/cloud/atlas\">MongoDB Atlas</a>. In this tutorial, I'll be using mLab although it doesn't matter which one you choose as long as you have the connection url.</p>\n<p><video src=\"https://media.giphy.com/media/XHGAZo1d0vlSsWXEZP/giphy.mp4\" loop muted autoplay playsinline width=\"300\"></video></p>\n<h2>Adding new packages to the Express Application</h2>\n<p>I will be continuing with the project from the <a href=\"/blog/creating-a-basic-server-with-express-js\">last post in the series</a>. The code for that project can be found <a href=\"https://github.com/iamtimsmith/express-tutorials\">here</a>. As a brief overview, the project so far has a few basic routes set up with controllers, is being served at port 4000, and is using pug as a view engine.</p>\n<p>To begin adding MongoDB to the project, you should add a few packages: <code>dotenv</code> and <code>mongoose</code>. Dotenv allows us to use environment variables in a <code>.env</code> file. Get it? Dot-E-N-V? Pretty clever, huh? Mongoose is an Object-Relational-Mapper, or ORM, which converts the data from your MongoDB to something the Express application can use. I will be <a href=\"/blog/getting-started-with-the-linux-cli/\">using the terminal to do various things</a>, though you can use whatever method you like. Finally, slugify allows you to turn a string into a url slug. The code below will add these packages to your project:</p>\n<div class=\"gatsby-code-title pre-title\">Terminal</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i dotenv mongoose slugify</code></pre></div>\n<p>Assuming you have set up your database, whether locally or remotely, it's time to create a <code>.env</code> file. The code below will create the file:</p>\n<div class=\"gatsby-code-title pre-title\">Terminal</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">touch</span> .env</code></pre></div>\n<p>Inside the .env file, you need to add a key and value for the url. The reason for using a .env file is twofold. First, the database location isn't hardcoded in the project which makes things far more secure. Second, different values can be used for different environments, thus making sure that development isn't affecting data in the production environment. I will use the code below in my <code>.env</code> file. Please note: the connection string below will not work. It is simply to show what it will look like.</p>\n<div class=\"gatsby-code-title pre-title\">.env</div>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\">MONGO_URI=mongodb://username:password@ds12345.mlab.com:54321/iamtimsmith-express-tutorial</code></pre></div>\n<p>The next step (if not already done) should always be to add the <code>.env</code> file to the <code>.gitignore</code>. This is a VERY important step and ensures we aren't making any valuable data public. This is especially important since the username and password for the database is in the connection string, although it's good practice to always add <code>.env</code> files to the <code>.gitignore</code> regardless of what the contents are.</p>\n<div class=\"gatsby-code-title pre-title\">.gitignore</div>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\">node_modules\n.env</code></pre></div>\n<p>Whew. Now you've got a <code>.env</code> file with the connection string for the database. You have also made sure it's not being pushed into a repository. The next thing you need to do is tell the Express application about the <code>.env</code> file and use it to connect to the database. To do this, open the server file and add the following lines:</p>\n<div class=\"gatsby-code-title pre-title\">server.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> bodyParser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body-parser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Include mongoose in the server file</span>\n<span class=\"token keyword\">const</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Tell the server file about the .env file</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">4000</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Use the MONGO_URI from .env or use local mongodb</span>\n<span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">MONGO_URI</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"mongodb://localhost:27017/express-tutorial\"</span><span class=\"token punctuation\">;</span> \n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'view engine'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pug'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>bodyParser<span class=\"token punctuation\">.</span><span class=\"token function\">urlencoded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> extended<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./routes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Success! Your application is running on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Connect the Express application to MongoDB</span>\nmongoose<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>useNewUrlParser<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The code above adds the mongoose package to the file, gets the connection string for the database, and connects to MongoDB using the url assigned to <code>db</code>. We're done right? Well.....</p>\n<p><video src=\"https://media.giphy.com/media/s3d5ugcxFDApG/giphy.mp4\" autoplay loop muted playsinline width=\"250\"></video></p>\n<h2>Setting up Models with Mongoose</h2>\n<p>I mentioned in the <a href=\"/blog/creating-a-basic-server-with-express-js\">last post</a> that I'm using an MVC architecture. The Express project already has views and controllers. It's just missing the models, which you can set up now that a data source is connected. Mongoose gives us the ability to set up models pretty quickly and easily. A model represents a type of data in the application and what fields (or columns) will be available. To begin, you can create a directory for models and create a file for your first model, in this case a blog post. The following code will create the directory and add a file for a model.</p>\n<div class=\"gatsby-code-title pre-title\">Terminal</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> models <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">touch</span> models/Post.js</code></pre></div>\n<p>Open up <code>models/Post.js</code> and you can begin creating a model for blog posts. First, you'll create a schema which determines what fields are available, what data type those fields should be, and other configurations. In the schema, you can set whether the value should be a unique value, default values, and more! The code below will get a post content type set up with several fields to use:</p>\n<div class=\"gatsby-code-title pre-title\">models/Post.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Schema <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span>Schema<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> postSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Schema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  title<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span>\n  author<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span>\n  slug<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> unique<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  body<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span>\n  comments<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> body<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">:</span> Date <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  date<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">,</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">.</span>now <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> Post <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span><span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Post'</span><span class=\"token punctuation\">,</span> postSchema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let's briefly go over what's happening here: First you import the mongoose library for use in this file. Next you create a schema called <code>postSchema</code> with the various fields fields you want on that data type. You may notice that the title, author, and body all have a value of <code>String</code> while comments and date have different stuff. That's because the data type is required for any field and writing out <code>title: {type: String}</code> a bunch of times sounds like a pain. The mongoose developers thought about this and decided to make the <code>title: String</code> shorthand, which does the same thing. If you need to add more information such as a default, unique, or something else you'll still have to use the object. </p>\n<p>In addition, you may notice that the date field is an object while the comments field is actually wrapped in an array. That's because the date is saving a single value and the object defines the parameters for that value. The comments field is actually going to be an array of data with each item in the array having the parameters specified in the object.</p>\n<p>Finally, you define the model for Post using the schema which makes it available to use when handling data in your application.</p>\n<blockquote>\n<p>This is the second in a series of posts about setting up a project with Express.</p>\n<ol>\n<li><a href=\"/blog/creating-a-basic-server-with-express-js\">Creating a Basic Server with Express.js</a></li>\n<li>Using MongoDB with an Express.js project</li>\n</ol>\n</blockquote>\n<!-- > 1. [Adding Authentication to an Express application with Passport.js](/blog/adding-auth-to-express-application-with-passport) -->","excerpt":"MongoDB is a nosql database that is growing in popularity. In this post, I'll show you how you can use it in your next Express application. The MERN stack…","fields":{"slug":"/blog/using-mongodb-with-express-js/"},"frontmatter":{"title":"Using MongoDB with an Express.js Application","date":"February 13, 2020","keywords":"expressjs, nodejs, mern, mern stack, javascript, mongodb","description":"MongoDB is a nosql database that is growing in popularity. In this post, I'll show you how you can use it in your next Express application.","featured_image":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHrRuqVD//EABoQAAICAwAAAAAAAAAAAAAAAAECABAREhP/2gAIAQEAAQUCLYbqIp2F/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAABBQAAAAAAAAAAAAAAAAARAAEgMUH/2gAIAQEABj8CAxU8f//EABkQAQACAwAAAAAAAAAAAAAAAAEQIREgMf/aAAgBAQABPyHoS2qAHIaf/9oADAMBAAIAAwAAABCQz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQEAAgMBAAAAAAAAAAAAAAERACEQcaHR/9oACAEBAAE/EBGgR6MmDvrD7jI0Bm8m7z//2Q==","aspectRatio":1.5,"src":"/static/6e8f4d19d781f30255986aad701a6970/14dee/featured_image.jpg","srcSet":"/static/6e8f4d19d781f30255986aad701a6970/6ece9/featured_image.jpg 480w,\n/static/6e8f4d19d781f30255986aad701a6970/0a89a/featured_image.jpg 960w,\n/static/6e8f4d19d781f30255986aad701a6970/14dee/featured_image.jpg 1920w","sizes":"(max-width: 1920px) 100vw, 1920px"}}},"tags":"#express #mongodb"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/using-mongodb-with-express-js/","previous":{"fields":{"slug":"/blog/keep-and-grow-client-base-during-pandemic/","type":"posts"}},"next":{"fields":{"slug":"/blog/creating-a-basic-server-with-express-js/","type":"posts"}}}}}